<% provide(:title, "#{@user.name}") %>
<div class="row" style="margin-top:80px;">
  <div class="col-md-4 text-center">
    <%= image_tag @user.avatar, class: 'img-circle', alt: 'users avatar' %>
    <div class="username" style="margin:20px 0;">
      <span style="margin-right:20px;"><b><%= @user.name %></b></span>
      <%= link_to 'Edit Profile', edit_user_path(@user), class: 'btn btn-info' if current_user?(user: @user) %>
    </div>
    <div class="reviews-count" style="margin-bottom:40px;">
      <span><%= @reviews.count %> reviews</span>
    </div>
  </div>
  <div class="col-md-8">
    <% if @reviews.any? %>
    <h4 style="margin-bottom:20px;">Reviewed albums</h4>
      <!-- TODO: パーシャル化 -->
      <% @reviews.each do |review| %>
        <div class="row" style="margin-bottom:20px; padding-bottom:20px; border-bottom:solid 1px #eee;">
          <div class="col-md-3" style="margin-bottom:20px;">
            <%= link_to image_tag(review.album.image, class: "img-responsive", style: 'margin-right:20px;'), album_path(review.album) %>
          </div>
          <div class="col-md-9">
            <div class="star-rating" style="display:inline; margin-right:20px;" data-score= <%= review.rating %> ></div>
            <span><%= review.created_at.strftime(" %Y %b %d") %></span>
            <p style="font-size:16px; margin-top:20px;"><%= review.title %></p>
            <p><%= simple_format(review.text) %></p>
            <% if current_user?(user: @user) %>
              <span style="float:right;">
                <a href="#" data-toggle="modal" data-target="#myModal-<%= review.id %>">Edit</a> /
                <%= link_to "Delete", review_path(review), method: :delete, data: { confirm: 'Are you sure?' } %>
              </span>
            <% end %>
          </div>
        </div>
        <%= render 'reviews/edit_modal', review: review %>
      <% end %>
      <%= paginate @reviews %>
    <% else %>
    <!-- TODO: ユーザのレビューがない場合、ファーストアクションを表示する -->
      <div class="row">
        <div class="col-md-6">
          <div class="panel panel-default">
            <div class="panel-body text-center">
              <h4>Search Artists to post your first review!</h4>
              <div class="highest-rated">
                <%= link_to 'Search Artists', artists_path, class: 'btn btn-primary' %>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="panel panel-default">
            <div class="panel-body text-center">
              <h4>Search Albums to post your first review!</h4>
              <div class="highest-rated">
                <%= link_to 'Search Albums', albums_path, class: 'btn btn-primary' %>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<script>
  $('.star-rating').raty({
    path: '/assets/',
    readOnly: true,
    size: 6,
    half: true,
    score: function() {
      return $(this).attr('data-score');
    }
  });
</script>
